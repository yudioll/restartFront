---
title: Https 握手原理
tags: 
  - http
  - 网络
  - 面试
categories: 
  - network
date: 2021-03-27 19:04:39
permalink: /pages/543a92/
---

# https

> 原理概念：httsp是在tcp和http中加入一层数据加密层，ssl/tsl ,http 和tcp通信的时候先经过加密层加密在传给传给tcp，tcp进行解密，反之一样

### 基本概念和理解

> tls和ssl的功能实现主要基于三类算法，散列函数，非对称加密，和对称加密，其利用非对称加密进行身份验证和密钥协商，对称加密采用协商的秘钥对数据进行加密，基于散列函数验证数据得完整性。

#### 几个主要的点

* 非对称加密主要用于身份验证和秘钥协商
* 对象加密主要对数据进行加密
* 散列函数主要用于对数据完整性的验证

### ssl和tsl的区别

* ssl是tsl的前身，因为ssl有漏洞原因，现在基本使用tsl方案

### ssl和tsl协议和证书的区别

* 根本没有关联，一般都会从第三方申请证书

### 公钥私钥，对称秘钥的区别

* 公钥和私钥成对出现
* 公钥用于对敏感信息加密，私钥用于标识发送方，所以公钥是保证数据得安全

* 采用公私钥加密的方式叫做非对称加密
    > 对称加密服务端将私钥发给客户端，客户端用私钥进行加密，回传给服务端，服务端用公钥进行解密，存在私钥被第三方拦截问题，所以采用非对称加密

### 为什么使用非对称加密

* 以对称加密方式加密时必须将密钥也发给对方。可究竟怎样才能安全地转交？在互联网上转发密钥时，如果通信被监听那么密钥就可会落人攻击者之手，同时也就失去了加密的意义。另外还得设法安全地保管接收到的密钥，所以使用非对称加密。

### 非对称加密

> 加密算法是rsa ecc dh，加密使用一对非对称秘钥，公钥发给客户端，服务端私钥进行解密

### 非对称加密的特点

* 有一对秘钥，公钥和私钥
* 公钥加密的内容只有私钥可以解开，私钥加密的内容只有公钥能解开
* 公钥可以发送给所有客户端，私钥只要服务端
* 可以一对多，服务端对多个客户端

### 非对称加密的缺点

* 公钥可以被黑客拦截，进行解密
* 公钥不包含服务器信息，无法验证服务器的安全性，公钥可以被黑客进行篡改和拦截
* 非对称加密效率低

### 对称加密和非对称加密的区别

* 对称加密需要将生成的私钥发送给对方
* 对称加密效率高
* 对称加密安全性更低

### https采用对称加密和非对称加密的方式

> 先采用非对称加密，发送方用公钥进行加密‘秘钥’，接收方通过公钥解密，在采用对称加密方式进行通信

---

### 数字签名

> 网络传输过程中需要经过很多中间节点，虽然数据无法被解密，但可能被篡改，那如何校验数据的完整性呢？ 那就是校验数字签名。

* 如何生成数字签名
    > 发送方先将一段文本用hash 函数生成消息摘要，在用秘钥进行加密生成数字签名
* 效验比对数字签名流程
    > 接受方接受到了发送方的原文和数字签名，首签用发送方的公钥进行解密数字签名生成消息摘要1，在通过hash函数对原文进行翻译生成消息摘要2，比对俩个消息摘要，如果不同说明被篡改

* 效验数字签名的时候怎么确定发送方的身份问题
    > 公钥不包含服务信息，不能知道发送方的身份，所以需要ca证书来证明发送方的身份

* 示例

!['中间截获过程'](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73017d487eb54088b1128a8ae5557b82~tplv-k3u1fbpfcp-watermark.image?imageslim)

> 客户端无法识别公钥是真服务端发过来的，说白了就是我拿到了公钥，但是不知道是谁的公钥

---
### 数字证书认证机构的流程

* 机构向ca提交申请，携带信息包括，服务端公钥、域名信息、组织信息、签发机构的ca信息
* 审核通过之后，ca会颁发证书，证书包括申请者的公钥，ca机构信息，到期时间，证书序列号，签名
    > ca证书中签名的生成，首签通过散列函数对明文信息生成摘要，在通过ca秘钥加密摘要生成签名【数字签名生成过程】
* client想sever请求，返回ca的证书
* client 验证证书，首先client 内部安装了信任的ca机构，首签通过相同的散列函数解析原文生成摘要1，在通过ca的公钥解析
ca私钥加密的信息生成摘要2，对比摘要【数字签名验证的过程】
* client 还会验证证书的合法性，是否过期，如果过期或者不合法，通常就会在chrome浏览器左上角看见不安全的表示

### 如果只使用第三方机构加密

    > 将网站信息通过特点的算法生成秘钥，服务端在通过私钥加密返回的秘钥【第三方的数字证书生成过程】

* 该种方式的特点，首签黑客也也可以申请第三方的信息，以下网上的实例

![黑客截取第三方机构的加密过程](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de3947f4b265403fad5c89b2a1f9b82b~tplv-k3u1fbpfcp-watermark.image)

* 用这种方式缺少了数字签名比对的古城，这样的缺点是客户端还是不知道server端是谁

### 数字签名的作用

* client能知道发送方是谁，其他人无法冒充
* 能够验证数据得完整性，无法被黑客篡改

### https 工作流的过程

* 首签客户端clent发起请求443端口，这时候就是请求证书
* server收到请求返回公钥证书
* client收到公钥证书，验证合法性
* client 生成伪随

机数（会话秘钥），通过server 的公钥进行加密，发送给server（这一步生成了对称秘钥）
* server通过私钥解析处client端的会话秘钥（服务端接收到了对称秘钥）**以上步骤就是非对称加密，以下消息传递的过程就是对称加密**
* server通过会话秘钥加密明文A发送给client
* client通过会话密码解密



